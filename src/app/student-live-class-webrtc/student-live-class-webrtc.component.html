<div id="liveContainer" class="live-container">

  <!-- JOIN OVERLAY - Shows on both desktop and mobile -->
  <div *ngIf="!hasUserInteracted" class="join-overlay">
    <button (click)="joinClass()" class="join-btn">
      Join Live Class
    </button>
  </div>

  <!-- ================= DESKTOP VIEW ================= -->
  <div class="desktop-view">

    <!-- MAIN -->
    <div class="live-main">

      <!-- VIDEO -->
      <div class="video-stage">

        <video #teacherScreen
               autoplay
               playsinline
               class="screen-video">
        </video>

        <video #teacherCamera
               muted
               autoplay
               playsinline
               class="camera-video">
        </video>

        <div *ngIf="currentSpeaker" class="speaker-label">
          {{ currentSpeaker }}
        </div>

      </div>

      <!-- CHAT -->
      <div class="chat-panel" [class.chat-open]="isChatOpen">

        <div class="chat-header">
          <span>Live Chat</span>
          <button (click)="toggleChat()" class="chat-close">âœ•</button>
        </div>

        <div class="chat-body" #chatContainer>
          <!-- ðŸ”„ Loading Indicator -->
          <div *ngIf="isLoadingOlderMessages" class="chat-loading">
            <div class="spinner"></div>
            <span>Loading older messages...</span>
          </div>

          <!-- ðŸ End of Messages Indicator -->
          <div *ngIf="!hasMoreMessages && messages.length > 0" class="chat-end-marker">
            <p>ðŸ“Œ You've reached the beginning of the conversation</p>
          </div>

          <!-- ðŸ’¬ Messages -->
          <div *ngFor="let msg of messages" class="chat-message">
            <div class="chat-meta">
      {{ msg.SenderName }} â€¢ {{ msg.CreatedAt | date:'shortTime' }}
            </div>
            <div class="chat-text">
      {{ msg.MessageText }}
            </div>
          </div>
        </div>

        <div class="chat-input-wrap">
          <div class="chat-input-container">
            <input type="text"
                   [(ngModel)]="chatInput"
                   (keydown.enter)="sendMessage()"
                   [disabled]="isSendingMessage"
                   placeholder="Type message..." />
            <button (click)="sendMessage()" 
                    [disabled]="isSendingMessage || !chatInput.trim()"
                    class="send-btn">
              <span *ngIf="!isSendingMessage">âœ“</span>
              <span *ngIf="isSendingMessage" class="spinner-small"></span>
            </button>
          </div>
        </div>

      </div> 
             

    </div>

    <!-- CONTROL BAR -->
    <div class="control-bar">
      <button (click)="toggleMic()" class="control-btn mic-btn">
        {{ isMicOn ? 'Mic ON' : 'Mic OFF' }}
      </button>

      <button (click)="toggleChat()" class="control-btn chat-btn">
        Chat
        <span *ngIf="unreadCount > 0" class="badge">
          {{ unreadCount }}
        </span>
      </button>

      <button (click)="toggleFullScreen()" class="control-btn fs-btn">
        Fullscreen
      </button>
    </div>

  </div>



  <!-- ================= MOBILE VIEW ================= -->
  <div class="mobile-view">

    <div class="mobile-video-wrapper">

      <video #teacherScreenMobile
             autoplay
             playsinline
             class="mobile-video">
      </video>

      <video #teacherCameraMobile
             muted
             autoplay
             playsinline
             class="mobile-camera">
      </video>

      <button (click)="toggleFullScreen()"
              class="mobile-fullscreen-btn">
        â›¶
      </button>

    </div>

    <div class="mobile-chat">

      <div class="mobile-chat-body">
        <!-- ðŸ”„ Loading Indicator -->
        <div *ngIf="isLoadingOlderMessages" class="chat-loading">
          <div class="spinner"></div>
          <span>Loading older messages...</span>
        </div>

        <!-- ðŸ End of Messages Indicator -->
        <div *ngIf="!hasMoreMessages && messages.length > 0" class="chat-end-marker">
          <p>ðŸ“Œ You've reached the beginning</p>
        </div>

        <!-- ðŸ’¬ Messages -->
        <div *ngFor="let msg of messages" class="chat-message">
          <div class="chat-meta">
            {{ msg.SenderName }} â€¢ {{ msg.CreatedAt | date:'shortTime' }}
          </div>
          <div class="chat-text">
            {{ msg.MessageText }}
          </div>
        </div>
      </div>

      <div class="mobile-chat-input">
        <div class="chat-input-container">
          <input type="text"
                 [(ngModel)]="chatInput"
                 (keydown.enter)="sendMessage()"
                 [disabled]="isSendingMessage"
                 placeholder="Type message..." />
          <button (click)="sendMessage()" 
                  [disabled]="isSendingMessage || !chatInput.trim()"
                  class="send-btn">
            <span *ngIf="!isSendingMessage">âœ“</span>
            <span *ngIf="isSendingMessage" class="spinner-small"></span>
          </button>
        </div>
      </div>

    </div>

  </div>

</div>