<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 space-y-8">

  <!-- ================= DASHBOARD VIEW ================= -->
  <ng-container *ngIf="view === 'dashboard'">

    <!-- ===== Live Announcements ===== -->
    <div *ngIf="classannouncement?.length" class="space-y-3">

      <div *ngFor="let ann of classannouncement"
           class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3
                  bg-red-50 border border-red-200 rounded-lg px-4 sm:px-6 py-3">

        <div class="flex items-center gap-3">
          <span class="w-3 h-3 bg-red-600 rounded-full animate-pulse"></span>
          <div class="text-sm text-red-800 font-medium leading-snug">
            {{ ann.courseName }} class started for batch {{ ann.batchName }}
          </div>
        </div>

        <button *ngIf="ann.liveSessionId"
                (click)="JoinLiveSession(ann)"
                class="w-full sm:w-auto bg-red-600 text-white text-xs font-semibold
                       px-4 py-2 rounded-md hover:bg-red-700 transition">
          Join Live
        </button>

      </div>

    </div>

    <!-- ===== Section Title ===== -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
      <h2 class="text-xl sm:text-2xl font-bold text-gray-900">
        My Courses
      </h2>

      <span class="text-sm text-gray-500">
        {{ AvailableCourse?.length }} enrolled
      </span>
    </div>

    <!-- ===== Courses Grid ===== -->
    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 xl:grid-cols-3">

      <div *ngFor="let course of AvailableCourse"
           class="bg-white border border-gray-200 rounded-xl overflow-hidden
                  shadow-sm hover:shadow-md transition flex flex-col">

        <!-- Image -->
        <div class="h-40 sm:h-44 relative">
          <img [src]="course.CourseImage"
               class="w-full h-full object-cover" />

          <div class="absolute top-3 right-3 text-xs font-semibold
                      px-3 py-1 rounded-full"
               [ngClass]="course?.isActive === '1'
                 ? 'bg-green-100 text-green-700'
                 : 'bg-red-100 text-red-700'">
            {{ course?.isActive === '1' ? 'Active' : 'Expired' }}
          </div>
        </div>

        <!-- Body -->
        <div class="p-4 sm:p-5 flex flex-col flex-1">

          <div class="text-xs text-gray-500 mb-2">
            Batch: {{ course.batchName }}
          </div>

          <h3 class="font-semibold text-gray-900 mb-3 text-sm sm:text-base">
            {{ course.CourseName }}
          </h3>

          <div class="mt-auto">

            <button
              *ngIf="course?.isActive === '1'"
              (click)="continueLearning(course)"
              class="w-full h-10 rounded-lg bg-purple-600 text-white
                     text-sm font-medium hover:bg-purple-700 transition">
              Continue Learning
            </button>

            <button
              *ngIf="course?.isActive === '2'"
              (click)="RenewCourse(course.courseId)"
              class="w-full h-10 rounded-lg bg-red-600 text-white
                     text-sm font-medium hover:bg-red-700 transition">
              Renew Subscription
            </button>

          </div>

        </div>

      </div>

    </div>

  </ng-container>

  <!-- ================= COURSE VIEW ================= -->
  <ng-container *ngIf="view === 'course' && selectedCourse">

    <!-- ===== Course Header ===== -->
    <div class="bg-white border border-gray-200 rounded-xl
                p-4 sm:p-6 space-y-4">

      <div class="flex flex-col sm:flex-row sm:items-center
                  sm:justify-between gap-4">

        <div class="flex items-start sm:items-center gap-3 sm:gap-4">

          <button (click)="goBack()"
                  class="text-sm font-semibold text-purple-600 hover:underline">
            ‚Üê Back
          </button>

          <h1 class="text-lg sm:text-2xl font-bold text-gray-900 leading-snug">
            {{ selectedCourse.title }}
          </h1>

        </div>

        <button *ngIf="selectedCourse.live?.isLive"
                class="w-full sm:w-auto bg-red-600 text-white text-sm
                       px-4 py-2 rounded-md hover:bg-red-700 transition">
          Join Live
        </button>

      </div>

      <!-- Progress -->
      <div class="space-y-2">
        <div class="flex justify-between text-sm text-gray-600">
          <span>Progress</span>
          <span>{{ selectedCourse.percent }}%</span>
        </div>

        <div class="w-full h-3 bg-gray-200 rounded-full">
          <div class="h-3 bg-purple-600 rounded-full"
               [style.width.%]="selectedCourse.percent">
          </div>
        </div>
      </div>

    </div>

    <!-- ===== Tabs ===== -->
    <div class="border-b border-gray-200 mt-6 overflow-x-auto">
      <div class="flex gap-6 sm:gap-8 min-w-max px-1">

        <button *ngFor="let tab of ['chapters','live','quiz','notes','progress']"
                (click)="activeTab = tab"
                class="pb-3 text-sm font-semibold whitespace-nowrap
                       transition cursor-pointer"
                [ngClass]="activeTab === tab
                  ? 'border-b-2 border-purple-600 text-purple-600'
                  : 'text-gray-500 hover:text-gray-700'">
          {{ tab | titlecase }}
        </button>

      </div>
    </div>

    <!-- ===== Tab Content ===== -->
    <div class="bg-white border border-gray-200 rounded-xl
                p-4 sm:p-6 mt-6">

      <!-- ===== CHAPTERS ===== -->
      <ng-container *ngIf="activeTab === 'chapters'">

        <div class="space-y-4">

          <div *ngFor="let ch of courseModules; let ci = index"
               class="border border-gray-200 rounded-lg overflow-hidden
                      hover:shadow-sm transition">

            <!-- Module Header -->
            <button
              (click)="toggleLesson(ci)"
              class="w-full flex items-center justify-between
                     px-4 sm:px-6 py-4 cursor-pointer
                     bg-gray-50 text-left">

              <div class="flex flex-col">

                <span class="text-xs uppercase tracking-wide text-gray-400">
                  Module {{ ch.ModuleNo }}
                </span>

                <span class="text-sm sm:text-base font-semibold
                             text-gray-900 mt-1">
                  {{ ch.ModuleName }}
                </span>

              </div>

              <svg
                class="w-5 h-5 text-gray-500 transition-transform duration-300"
                [ngClass]="{ 'rotate-180': isLessonOpen(ci) }"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24">

                <path stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 9l6 6 6-6" />

              </svg>

            </button>

            <!-- Module Content -->
            <div *ngIf="isLessonOpen(ci)"
                 class="px-5 sm:px-8 py-4 sm:py-5 bg-white border-t border-gray-200">

              <ul class="space-y-3 text-sm text-gray-700">

                <li *ngFor="let topic of ch.Topics.split('|')"
                    class="flex items-start gap-3">

                  <span class="w-2 h-2 mt-2 bg-purple-500 rounded-full"></span>

                  <span class="leading-relaxed break-words">
                    {{ topic }}
                  </span>

                </li>

              </ul>

            </div>

          </div>

        </div>

      </ng-container>

      <!-- ===== LIVE TAB ===== -->
      <ng-container *ngIf="activeTab === 'live'">
        <div class="text-sm text-gray-700">
          Attendance history and upcoming sessions should be dynamic.
        </div>
      </ng-container>

      <!-- ===== QUIZ TAB ===== -->
      <ng-container *ngIf="activeTab === 'quiz'">
        <div class="text-sm text-gray-700">
          Quiz performance analytics should be displayed here.
        </div>
      </ng-container>

      <!-- ===== NOTES TAB ===== -->
      <ng-container *ngIf="activeTab === 'notes'">
        <div class="text-sm text-gray-700">
          Lecture notes list here.
        </div>
      </ng-container>

      <!-- ===== PROGRESS TAB ===== -->
      <ng-container *ngIf="activeTab === 'progress'">

        <div class="space-y-3 text-sm text-gray-700">
          <div>Chapters Completed: 3/12</div>
          <div>Attendance: 4/26</div>
          <div>Quizzes Cleared: 2/7</div>
        </div>

      </ng-container>

    </div>

  </ng-container>

</div>
