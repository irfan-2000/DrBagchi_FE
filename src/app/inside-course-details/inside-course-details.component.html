<!-- course-details.component.html -->
 <div *ngIf="isLoading" class="bagchi-loader-overlay">
  <div class="bagchi-loader-card">
    <div class="bagchi-spinner"></div>
    <div class="bagchi-loading-text">Please wait…</div>
  </div>
</div>
<div class="max-w-7xl mx-auto px-4 md:px-8 py-8 space-y-10">

   <div class="grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-8">
    <section class="bg-white border border-gray-200 rounded-xl p-8 space-y-10">

  <!-- ================= COURSE COVER ================= -->
  <div class="aspect-[16/9] rounded-lg overflow-hidden bg-gray-100">
    <img
      [src]="Course?.ImagewithPath"
      alt="{{Course?.CourseName}} cover"
      class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
    />
  </div>

  <!-- ================= TITLE & META ================= -->
  <div class="space-y-3">

    <h1 class="text-3xl font-semibold text-gray-900 leading-tight">
      {{ Course?.CourseName }}
    </h1>

    <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600">
      <span class="font-medium text-gray-900">
        {{ Course?.Teacher }}
      </span>

      <span>•</span>

      <span>
        {{ Course?.CourseLevel }}
      </span>

      <span *ngIf="parsedDescription?.duration">
        • {{ parsedDescription?.duration }}
      </span>
    </div>

  </div>

  <!-- ================= DESCRIPTION ================= -->
  <div class="border-t pt-8 space-y-4">

    <h2 class="text-xl font-semibold text-gray-900">
      Course Overview
    </h2>

    <p class="text-gray-700 leading-relaxed">
      {{ Course?.ShortDescription || 'No short description available.' }}
    </p>

    <p class="text-gray-600 leading-relaxed">
      {{ Course?.Overview || 'Detailed overview coming soon.' }}
    </p>

  </div>

  <!-- ================= FEATURES GRID ================= -->
  <div class="border-t pt-8 grid md:grid-cols-3 gap-10">

    <!-- Highlights -->
    <div *ngIf="Course?.Highlights?.length">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        Highlights
      </h3>

      <ul class="space-y-3 text-sm text-gray-700">
        <li *ngFor="let h of Course.Highlights" class="flex gap-3">
          <span class="text-green-600 mt-1">✔</span>
          <span>{{ h }}</span>
        </li>
      </ul>
    </div>

    <!-- Requirements -->
    <div *ngIf="Course?.Requirements?.length">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        Requirements
      </h3>

      <ul class="space-y-3 text-sm text-gray-700">
        <li *ngFor="let r of Course.Requirements">
          • {{ r }}
        </li>
      </ul>
    </div>

    <!-- Objectives -->
    <div *ngIf="Course?.Objectives?.length">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        Objectives
      </h3>

      <ul class="space-y-3 text-sm text-gray-700">
        <li *ngFor="let o of Course.Objectives">
          • {{ o }}
        </li>
      </ul>
    </div>

  </div>

  <!-- ================= BATCHES ================= -->
  <div *ngIf="Course?.Batches?.length" class="border-t pt-8 space-y-5">

    <h3 class="text-lg font-semibold text-gray-900">
      Upcoming Batches
    </h3>

    <div class="grid sm:grid-cols-2 gap-4">

      <div
        *ngFor="let b of Course.Batches"
        (click)="selectBatch(b)"
        class="cursor-pointer border rounded-lg p-5 transition duration-200"
        [ngClass]="selectedBatchId === b.batchId
                   ? 'border-purple-600 ring-2 ring-purple-200 bg-purple-50'
                   : 'border-gray-200 hover:border-purple-400 hover:shadow-sm'">

        <div class="font-semibold text-gray-900 mb-2">
          {{ b.batchName }}
        </div>

        <div class="text-sm text-gray-600 space-y-1">
          <div>
            {{ b.startDate | date:'MMM dd, yyyy' }} –
            {{ b.endDate | date:'MMM dd, yyyy' }}
          </div>

          <div>
            {{ formatTime(b.startTime) }} –
            {{ formatTime(b.endTime) }}
          </div>
        </div>

      </div>

    </div>

  </div>

</section>

 <aside class="bg-white border border-gray-200 rounded-xl p-8 space-y-8 sticky top-6">

  <!-- ================= PRICE SECTION ================= -->
  <div class="space-y-2">

    <div class="flex items-baseline gap-3">
      <span class="text-4xl font-bold text-gray-900">
        ₹{{ discountedPrice || Course?.Price }}
      </span>

      <span *ngIf="Course?.OldPrice"
            class="text-lg text-gray-400 line-through">
        ₹{{ Course?.OldPrice }}
      </span>
    </div>

    <p class="text-sm text-gray-500">
      One-time secure payment
    </p>

  </div>


  <!-- ================= INSTALLMENT SELECTOR ================= -->
  <div *ngIf="Course?.PaymentType === 'installments' || Course?.PaymentType === 'both'"
       class="space-y-4 border-t pt-6">

    <label class="block text-sm font-semibold text-gray-800">
      Select Payment Option
    </label>

    <select
      [(ngModel)]="selectedPaymentOption"
      class="w-full rounded-lg border border-gray-300 px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500">

      <option value="" disabled selected>
        Select a payment option
      </option>

      <option [value]="'full'">
        Full Payment (₹{{ discountedPrice || Course?.Price }})
      </option>

      <option *ngFor="let inst of Course.Installments"
              [value]="inst.InstallmentNumber">
        Installment {{ inst.InstallmentNumber }} - ₹{{ inst.Amount }}
      </option>

    </select>

  </div>


  <!-- ================= INSTALLMENT TABLE ================= -->
  <div *ngIf="Course?.Installments?.length"
       class="border border-gray-200 rounded-lg overflow-hidden text-sm">

    <div class="bg-gray-50 px-4 py-3 font-semibold text-gray-800">
      Installment Details
    </div>

    <div *ngFor="let inst of Course.Installments"
         class="flex justify-between px-4 py-3 border-t text-gray-700">

      <div>
        <div class="font-medium">
          Installment {{ inst.InstallmentNumber }}
        </div>
        <div class="text-xs text-gray-500">
          Due in {{ inst.DueDaysFromStart }} days
        </div>
      </div>

      <div class="font-semibold text-gray-900">
        ₹{{ inst.Amount }}
      </div>

    </div>

  </div>


  <!-- ================= FIXED PAYMENT BLOCK ================= -->
  <div *ngIf="paymentType !== 'subscription' && paymentType =='fixed' && IsSusbcribed.isActive != '1'"
       class="border-t pt-8 space-y-6">

    <h3 class="text-lg font-semibold text-gray-900">
      Payment Options
    </h3>

    <!-- ONE TIME -->
    <div *ngIf="fixedpaymentplans.fixed_paymentMode === 'oneTime' || fixedpaymentplans.fixed_paymentMode === 'both'"
         class="border rounded-lg p-6 space-y-3">

      <div class="text-sm text-gray-600">
        One-Time Payment
      </div>

      <div class="text-3xl font-bold text-gray-900">
        ₹{{ fixedpaymentplans.Totalprice }}
      </div>

      <div class="text-sm text-green-600">
        ✔ Full course access included
      </div>

      <button
        (click)="Createorder_razorpay_NewOrder_fixed('oneTime')"
        class="w-full mt-4 h-12 rounded-lg bg-purple-600 text-white font-semibold hover:bg-purple-700 transition">
        Pay Now
      </button>

    </div>


    <!-- INSTALLMENTS -->
    <div *ngIf="fixedpaymentplans.fixed_paymentMode === 'installments' || fixedpaymentplans.fixed_paymentMode === 'both'"
         class="space-y-4">

      <h4 class="font-medium text-gray-800">
        Installment Breakdown
      </h4>

      <div class="space-y-3">

        <div *ngFor="let inst of fixedpaymentplans.Installments; let i = index"
             class="border rounded-lg p-4 flex justify-between items-center transition"
             [ngClass]="i === 0
                ? 'border-purple-600 bg-purple-50'
                : 'border-gray-200 bg-white opacity-70'">

          <div>
            <div class="font-semibold text-gray-900">
              Installment {{ inst.InstallmentNo }}
            </div>
            <div class="text-xs text-gray-500">
              Due in {{ inst.DaysAfterEnrollment }} days
            </div>
          </div>

          <div class="font-bold text-gray-900">
            ₹{{ inst.Amount }}
          </div>

        </div>

      </div>

      <button
        (click)="Createorder_razorpay_NewOrder_fixed('installments',fixedpaymentplans.Installments[0].InstallmentNo)"
        class="w-full h-12 rounded-lg bg-purple-600 text-white font-semibold hover:bg-purple-700 transition">
        Pay Installment ₹{{ fixedpaymentplans.Installments[0].Amount }}
      </button>

    </div>

  </div>


  <!-- ================= SUBSCRIPTION EXPIRED ================= -->
  <div *ngIf="IsSusbcribed.paymentType == 'subscription' && IsSusbcribed.isActive == '2'"
       class="border border-red-300 bg-red-50 rounded-lg p-6 space-y-3">

    <div class="flex justify-between items-center">
      <h3 class="font-semibold text-red-700">
        Subscription Expired
      </h3>

      <span class="text-xs bg-red-600 text-white px-3 py-1 rounded-full">
        Expired
      </span>
    </div>

    <p class="text-sm text-gray-700">
      Expired on
      <span class="font-semibold">
        {{ IsSusbcribed.validTill | date:'dd MMM yyyy' }}
      </span>
    </p>

  </div>


  <!-- ================= SUBSCRIPTION PLANS ================= -->
  <div *ngIf="paymentType === 'subscription' && IsSusbcribed.isActive != '1'"
       class="space-y-6 border-t pt-8">

    <h3 class="text-lg font-semibold text-gray-900">
      Choose Subscription Plan
    </h3>

    <div class="space-y-4">

      <!-- Monthly -->
      <label *ngIf="Subscriptionplans?.monthlyAmount > 0"
             class="border rounded-lg p-5 flex justify-between items-center cursor-pointer hover:border-purple-500 transition">

        <div>
          <div class="font-semibold text-gray-900">
            Monthly Plan
          </div>
          <div class="text-sm text-gray-500">
            Billed every month
          </div>
        </div>

        <div class="flex items-center gap-4">
          <span class="font-bold text-gray-900">
            ₹{{ Subscriptionplans?.monthlyAmount }}
          </span>
          <input type="radio"
                 name="plan"
                 [(ngModel)]="selectedPlan"
                 value="monthly"
                 class="accent-purple-600">
        </div>

      </label>

      <!-- Quarterly -->
      <label *ngIf="Subscriptionplans?.quarterlyAmount > 0"
             class="border rounded-lg p-5 flex justify-between items-center cursor-pointer hover:border-purple-500 transition">

        <div>
          <div class="font-semibold text-gray-900">
            Quarterly Plan
          </div>
          <div class="text-sm text-gray-500">
            Every 3 months
          </div>
        </div>

        <div class="flex items-center gap-4">
          <span class="font-bold text-gray-900">
            ₹{{ Subscriptionplans?.quarterlyAmount }}
          </span>
          <input type="radio"
                 name="plan"
                 [(ngModel)]="selectedPlan"
                 value="quarterly"
                 class="accent-purple-600">
        </div>

      </label>

      <!-- Yearly -->
      <label *ngIf="Subscriptionplans?.yearlyAmount > 0"
             class="border-2 border-purple-600 bg-purple-50 rounded-lg p-5 flex justify-between items-center cursor-pointer">

        <div>
          <div class="font-semibold text-gray-900">
            Yearly Plan
            <span class="text-green-600 text-sm ml-2">
              Best Value
            </span>
          </div>
          <div class="text-sm text-gray-500">
            Save more yearly
          </div>
        </div>

        <div class="flex items-center gap-4">
          <span class="font-bold text-gray-900">
            ₹{{ Subscriptionplans?.yearlyAmount }}
          </span>
          <input type="radio"
                 name="plan"
                 [(ngModel)]="selectedPlan"
                 value="yearly"
                 class="accent-purple-600">
        </div>

      </label>

    </div>

    <button
      (click)="Createorder_razorpay_NewOrder_subscription()"
      class="w-full h-12 rounded-lg bg-purple-600 text-white font-semibold hover:bg-purple-700 transition">
      Continue to Payment
    </button>

  </div>


  <!-- ================= ACTIVE STATUS ================= -->
  <div *ngIf="IsSusbcribed.isActive == '1'"
       class="border border-green-300 bg-green-50 rounded-lg p-6 space-y-4">

    <div class="flex justify-between items-center">
      <h3 class="font-semibold text-green-700">
        Subscription Active
      </h3>

      <span class="text-xs bg-green-600 text-white px-3 py-1 rounded-full">
        Active
      </span>
    </div>

    <div class="grid grid-cols-2 gap-4 text-sm">

      <div>
        <div class="text-gray-500">Plan</div>
        <div class="font-semibold text-gray-900">
          {{ IsSusbcribed.selectedPlan }}
        </div>
      </div>

      <div>
        <div class="text-gray-500">Amount Paid</div>
        <div class="font-semibold text-gray-900">
          ₹{{ IsSusbcribed.amountPaid }}
        </div>
      </div>

      <div>
        <div class="text-gray-500">Valid From</div>
        <div class="font-semibold text-gray-900">
          {{ IsSusbcribed.validFrom | date:'dd MMM yyyy' }}
        </div>
      </div>

      <div>
        <div class="text-gray-500">Valid Till</div>
        <div class="font-semibold text-gray-900">
          {{ IsSusbcribed.validTill | date:'dd MMM yyyy' }}
        </div>
      </div>

    </div>

  </div>

</aside>


  </div>
 
  <!-- ================= COURSE CURRICULUM ================= -->
<section class="bg-white border border-gray-200 rounded-xl p-8 space-y-6">

  <!-- Header -->
  <div>
    <h2 class="text-2xl font-bold text-gray-900">
      Course Curriculum
    </h2>
    <p class="text-sm text-gray-500 mt-1">
      Structured breakdown of modules and topics included in this course.
    </p>
  </div>


  <!-- Modules List -->
  <div class="space-y-4">

    <div *ngFor="let ch of courseModules; let ci = index"
         class="border border-gray-200 rounded-lg overflow-hidden transition">

      <!-- MODULE HEADER -->
      <button
        (click)="toggleLesson(ci, ci)"
        class="w-full flex items-center justify-between px-6 py-4 bg-gray-50 hover:bg-gray-100 transition text-left">

        <div class="flex flex-col">

          <span class="text-xs uppercase tracking-wide text-gray-400">
            Module {{ ch.ModuleNo }}
          </span>

          <span class="text-base font-semibold text-gray-900">
            {{ ch.ModuleName }}
          </span>

        </div>

        <!-- Arrow -->
        <svg
          class="w-5 h-5 text-gray-500 transition-transform duration-300"
          [ngClass]="{ 'rotate-180': isLessonOpen(ci, ci) }"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24">

          <path stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 9l6 6 6-6" />

        </svg>

      </button>


      <!-- MODULE CONTENT -->
      <div *ngIf="isLessonOpen(ci, ci)"
           class="px-8 py-5 bg-white border-t border-gray-200">

        <!-- Topics -->
        <ul class="space-y-3 text-sm text-gray-700">

          <li *ngFor="let t of ch.Topics.split('|')"
              class="flex items-start gap-3">

            <!-- Bullet Icon -->
            <span class="mt-1 w-2 h-2 bg-purple-500 rounded-full flex-shrink-0"></span>

            <span class="leading-relaxed">
              {{ t }}
            </span>

          </li>

        </ul>

      </div>

    </div>

  </div>

</section>


</div>
  